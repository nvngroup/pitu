# ‚ùì Baileys - Perguntas Frequentes (FAQ)

## üéØ √çndice R√°pido

- [üì± Conex√£o e Autentica√ß√£o](#-conex√£o-e-autentica√ß√£o)
- [üí¨ Mensagens e M√≠dia](#-mensagens-e-m√≠dia)
- [üîß Configura√ß√£o e Performance](#-configura√ß√£o-e-performance)
- [üêõ Problemas Comuns](#-problemas-comuns)
- [üè¢ Uso Comercial e Limites](#-uso-comercial-e-limites)
- [üõ†Ô∏è Desenvolvimento](#Ô∏è-desenvolvimento)

---

## üì± Conex√£o e Autentica√ß√£o

### ‚ùì Como funciona a conex√£o com o WhatsApp?

O Baileys se conecta diretamente ao WhatsApp Web via WebSocket, simulando um navegador. Voc√™ precisa "pare√°-lo" com seu WhatsApp mobile escaneando um QR Code ou usando c√≥digo de pareamento.

### ‚ùì QR Code vs C√≥digo de Pareamento - qual usar?

| QR Code | C√≥digo de Pareamento |
|---------|---------------------|
| ‚úÖ Sempre funciona | ‚ùå S√≥ funciona uma vez por n√∫mero |
| ‚úÖ Mais est√°vel | ‚úÖ N√£o precisa escanear |
| ‚ùå Precisa escanear manualmente | ‚ùå Menos confi√°vel |

**Recomenda√ß√£o**: Use QR Code para produ√ß√£o.

### ‚ùì Posso usar o mesmo n√∫mero em v√°rios bots?

‚ùå **N√£o!** Um n√∫mero WhatsApp s√≥ pode estar ativo em um bot por vez. Se tentar usar em v√°rios:
- Os bots ir√£o se desconectar mutuamente
- Pode resultar em ban tempor√°rio
- Funcionalidades podem parar de funcionar

### ‚ùì Preciso manter o WhatsApp mobile online?

‚úÖ **Sim**, mas com exce√ß√µes:
- WhatsApp mobile deve estar conectado √† internet
- N√£o precisa estar com o app aberto
- Se ficar offline por muito tempo (>14 dias), o bot pode desconectar

### ‚ùì Como salvar a sess√£o para n√£o precisar escanear sempre?

```typescript
import { useMultiFileAuthState } from '@nvngroup/pitu'

// Salva automaticamente em uma pasta
const { state, saveCreds } = await useMultiFileAuthState('minha-sessao')

const sock = makeWASocket({ auth: state })
sock.ev.on('creds.update', saveCreds) // IMPORTANTE: sempre adicionar isso!
```

---

## üí¨ Mensagens e M√≠dia

### ‚ùì Como detectar se uma mensagem √© para mim?

```typescript
sock.ev.on('messages.upsert', ({ messages }) => {
    for (const msg of messages) {
        // Ignorar mensagens que EU enviei
        if (msg.key.fromMe) continue

        // Ignorar mensagens vazias
        if (!msg.message) continue

        // Processar apenas mensagens recebidas
        console.log('Nova mensagem para processar!')
    }
})
```

### ‚ùì Como extrair texto de diferentes tipos de mensagem?

```typescript
function getMessageText(message: any): string {
    return message.conversation || // Mensagem de texto simples
           message.extendedTextMessage?.text || // Texto com formata√ß√£o/link
           message.imageMessage?.caption || // Legenda de imagem
           message.videoMessage?.caption || // Legenda de v√≠deo
           message.listResponseMessage?.singleSelectReply?.selectedRowId || // Resposta de lista
           ''
}
```

### ‚ùì Como enviar mensagens com formata√ß√£o?

```typescript
await sock.sendMessage(jid, {
    text: '*Negrito* _It√°lico_ ~Riscado~ ```C√≥digo``` \n\n' +
          '‚Ä¢ Lista item 1\n' +
          '‚Ä¢ Lista item 2\n\n' +
          'Link: https://github.com/brunocgc/Baileys'
})
```

### ‚ùì Como enviar √°udio que funciona em todos os dispositivos?

Para m√°xima compatibilidade, converta √°udio para OGG Opus:

```bash
# Instalar FFmpeg primeiro
ffmpeg -i input.mp3 -c:a libopus -ac 1 -avoid_negative_ts make_zero output.ogg
```

```typescript
await sock.sendMessage(jid, {
    audio: fs.readFileSync('output.ogg'),
    mimetype: 'audio/ogg; codecs=opus',
    ptt: true // Para nota de voz
})
```

### ‚ùì Como baixar m√≠dia recebida?

```typescript
import { downloadMediaMessage } from '@nvngroup/pitu'

const buffer = await downloadMediaMessage(
    message,
    'buffer', // ou 'stream'
    {},
    {
        logger: console,
        reuploadRequest: sock.updateMediaMessage
    }
)

fs.writeFileSync('media_baixada.jpg', buffer)
```

### ‚ùì Qual o limite de tamanho para m√≠dia?

| Tipo | Limite |
|------|--------|
| Imagem | 16 MB |
| V√≠deo | 16 MB |
| √Åudio | 16 MB |
| Documento | 100 MB |
| Sticker | 500 KB |

---

## üîß Configura√ß√£o e Performance

### ‚ùì Como melhorar a performance para grupos?

```typescript
import NodeCache from 'node-cache'

// 1. Cache de metadados de grupo
const groupCache = new NodeCache({ stdTTL: 300 })

const sock = makeWASocket({
    cachedGroupMetadata: async (jid) => groupCache.get(jid)
})

// 2. Atualizar cache quando necess√°rio
sock.ev.on('groups.update', async ([event]) => {
    const metadata = await sock.groupMetadata(event.id)
    groupCache.set(event.id, metadata)
})
```

### ‚ùì Como implementar rate limiting?

```typescript
class MessageQueue {
    private queue: Array<() => Promise<void>> = []
    private processing = false

    async add(task: () => Promise<void>) {
        this.queue.push(task)
        this.process()
    }

    private async process() {
        if (this.processing) return
        this.processing = true

        while (this.queue.length > 0) {
            const task = this.queue.shift()!
            await task()
            await new Promise(resolve => setTimeout(resolve, 1000)) // 1 seg entre mensagens
        }

        this.processing = false
    }
}

const messageQueue = new MessageQueue()

// Usar assim:
messageQueue.add(() => sock.sendMessage(jid, { text: 'Ol√°!' }))
```

### ‚ùì Como persistir mensagens e conversas?

```typescript
import { makeInMemoryStore } from '@nvngroup/pitu'

// Criar store
const store = makeInMemoryStore({})

// Conectar ao socket
store.bind(sock.ev)

// Salvar periodicamente
setInterval(() => {
    fs.writeFileSync('./store.json', JSON.stringify(store.toJSON()))
}, 30000)

// Carregar ao iniciar
if (fs.existsSync('./store.json')) {
    store.fromJSON(JSON.parse(fs.readFileSync('./store.json', 'utf8')))
}
```

---

## üêõ Problemas Comuns

### ‚ùì "Connection Closed" - por que acontece?

**Causas comuns**:
- Envio de muitas mensagens muito r√°pido
- WhatsApp mobile ficou offline
- Mudan√ßa de IP frequente
- Uso simult√¢neo do n√∫mero

**Solu√ß√µes**:
```typescript
sock.ev.on('connection.update', (update) => {
    if (update.connection === 'close') {
        const reason = update.lastDisconnect?.error?.output?.statusCode

        if (reason === DisconnectReason.loggedOut) {
            console.log('‚ùå Deslogado - escaneie QR novamente')
            // Deletar pasta de auth
        } else {
            console.log('üîÑ Reconectando...')
            // Recriar conex√£o
        }
    }
})
```

### ‚ùì Bot n√£o responde a certas mensagens?

**Verifica√ß√µes**:
```typescript
sock.ev.on('messages.upsert', ({ messages }) => {
    for (const msg of messages) {
        console.log('Mensagem recebida:', {
            de: msg.key.remoteJid,
            minhaMsg: msg.key.fromMe,
            tipo: Object.keys(msg.message || {}),
            conteudo: msg.message
        })

        // Suas verifica√ß√µes aqui...
    }
})
```

### ‚ùì "Module not found" ao importar?

**Para TypeScript**:
```typescript
import makeWASocket from '@nvngroup/pitu'
```

**Para JavaScript (CommonJS)**:
```javascript
const { default: makeWASocket } = require('@nvngroup/pitu')
```

**Para JavaScript (ES Modules)**:
```javascript
import makeWASocket from '@nvngroup/pitu'
```

### ‚ùì Erro ao enviar m√≠dia?

**Verifica√ß√µes comuns**:
```typescript
// 1. Arquivo existe?
if (!fs.existsSync('./imagem.jpg')) {
    throw new Error('Arquivo n√£o encontrado')
}

// 2. Tamanho adequado?
const stats = fs.statSync('./imagem.jpg')
if (stats.size > 16 * 1024 * 1024) {
    throw new Error('Arquivo muito grande (m√°x 16MB)')
}

// 3. Formato suportado?
const supportedImages = ['.jpg', '.jpeg', '.png', '.gif', '.webp']
const ext = path.extname('./imagem.jpg').toLowerCase()
if (!supportedImages.includes(ext)) {
    throw new Error('Formato n√£o suportado')
}
```

---

## üè¢ Uso Comercial e Limites

### ‚ùì Posso usar Baileys comercialmente?

‚úÖ **Sim**, mas com responsabilidade:
- ‚úÖ Bots de atendimento leg√≠timos
- ‚úÖ Notifica√ß√µes relevantes
- ‚úÖ Automa√ß√£o de processos internos
- ‚ùå Spam ou mensagens n√£o solicitadas
- ‚ùå Viola√ß√£o dos Termos do WhatsApp

### ‚ùì Quais s√£o os limites do WhatsApp?

**Limites de velocidade**:
- M√°ximo 1 mensagem por segundo
- M√°ximo 1000 mensagens por dia (n√∫mero novo)
- N√∫meros antigos t√™m limites maiores

**Limites de contatos**:
- M√°ximo 5 grupos novos por dia
- M√°ximo 256 participantes por grupo (dependendo da conta)

### ‚ùì Como evitar ser banido?

‚úÖ **Boas pr√°ticas**:
- Respeite limites de velocidade
- S√≥ envie mensagens relevantes
- Implemente opt-out (descadastro)
- Use n√∫meros dedicados para bots
- Monitore m√©tricas de entrega

‚ùå **Evite**:
- Spam ou mensagens em massa
- Envio para n√∫meros aleat√≥rios
- Conte√∫do impr√≥prio
- Viola√ß√£o de direitos autorais

### ‚ùì Como implementar opt-out?

```typescript
const optedOutUsers = new Set()

// Carregar lista de opt-out
function loadOptOutList() {
    try {
        const data = fs.readFileSync('./opted-out.json', 'utf8')
        const users = JSON.parse(data)
        users.forEach(user => optedOutUsers.add(user))
    } catch (error) {
        // Arquivo n√£o existe ainda
    }
}

// Salvar lista de opt-out
function saveOptOutList() {
    fs.writeFileSync('./opted-out.json', JSON.stringify([...optedOutUsers]))
}

// Verificar antes de enviar
async function sendMessage(jid: string, content: any) {
    if (optedOutUsers.has(jid)) {
        console.log(`Usu√°rio ${jid} optou por n√£o receber mensagens`)
        return
    }

    await sock.sendMessage(jid, content)
}

// Processar comando de opt-out
if (text.toLowerCase() === 'parar' || text.toLowerCase() === 'stop') {
    optedOutUsers.add(jid)
    saveOptOutList()
    await sock.sendMessage(jid, {
        text: '‚úÖ Voc√™ foi removido da nossa lista. N√£o receber√° mais mensagens autom√°ticas.\n\n' +
              'Para voltar a receber, digite "iniciar".'
    })
}
```

---

## üõ†Ô∏è Desenvolvimento

### ‚ùì Como debugar problemas?

```typescript
import pino from 'pino'

// Logger detalhado
const logger = pino({
    level: 'debug',
    transport: {
        target: 'pino-pretty',
        options: { colorize: true }
    }
})

const sock = makeWASocket({
    logger,
    printQRInTerminal: true
})

// Escutar todos os eventos
sock.ev.on('connection.update', console.log)
sock.ev.on('creds.update', () => console.log('Credenciais atualizadas'))
sock.ev.on('messaging-history.set', ({ messages, isLatest }) => {
    console.log(`Hist√≥rico: ${messages.length} mensagens (${isLatest ? 'completo' : 'parcial'})`)
})
```

### ‚ùì Como estruturar um projeto grande?

```
projeto/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ bot.ts              # Arquivo principal
‚îÇ   ‚îú‚îÄ‚îÄ handlers/           # Manipuladores de eventos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ messages.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ connection.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ groups.ts
‚îÇ   ‚îú‚îÄ‚îÄ commands/           # Comandos do bot
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ help.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user.ts
‚îÇ   ‚îú‚îÄ‚îÄ services/           # Servi√ßos externos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cache.ts
‚îÇ   ‚îú‚îÄ‚îÄ utils/              # Utilit√°rios
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logger.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validators.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ helpers.ts
‚îÇ   ‚îî‚îÄ‚îÄ types/              # Tipos TypeScript
‚îÇ       ‚îî‚îÄ‚îÄ index.ts
‚îú‚îÄ‚îÄ auth/                   # Dados de autentica√ß√£o (git ignore)
‚îú‚îÄ‚îÄ media/                  # M√≠dias tempor√°rias
‚îú‚îÄ‚îÄ config/                 # Configura√ß√µes
‚îÇ   ‚îú‚îÄ‚îÄ development.json
‚îÇ   ‚îî‚îÄ‚îÄ production.json
‚îî‚îÄ‚îÄ package.json
```

### ‚ùì Como fazer testes?

```typescript
// __tests__/bot.test.ts
import { createMockSocket } from '../src/utils/test-helpers'

describe('Bot', () => {
    let mockSocket: any

    beforeEach(() => {
        mockSocket = createMockSocket()
    })

    test('should respond to hello message', async () => {
        const message = {
            key: { fromMe: false, remoteJid: 'test@s.whatsapp.net' },
            message: { conversation: 'hello' }
        }

        await handleMessage(mockSocket, message)

        expect(mockSocket.sendMessage).toHaveBeenCalledWith(
            'test@s.whatsapp.net',
            { text: expect.stringContaining('Ol√°') }
        )
    })
})
```

### ‚ùì Como deploy em produ√ß√£o?

**Docker**:
```dockerfile
FROM node:18-alpine

WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

COPY . .
RUN npm run build

CMD ["npm", "start"]
```

**Docker Compose**:
```yaml
version: '3.8'
services:
  bot:
    build: .
    volumes:
      - ./auth:/app/auth
      - ./media:/app/media
    environment:
      - NODE_ENV=production
    restart: unless-stopped
```

---

## üÜò Ainda Precisa de Ajuda?

### üìö Recursos Adicionais

- üìñ [Documenta√ß√£o Completa](./DOCUMENTATION.md)
- üéØ [Exemplos Pr√°ticos](./EXAMPLES.md)
- ‚ö° [Guia de In√≠cio R√°pido](./QUICK-START.md)
- üìã [README Original](./README.md)

### ü§ù Comunidade

- üêô **GitHub**: [github.com/brunocgc/Baileys](https://github.com/brunocgc/Baileys)
- üåê **Site**: [nvngroup.com.br](https://www.nvngroup.com.br)

### üêõ Reportar Bugs

1. Verifique se o problema j√° foi reportado
2. Forne√ßa c√≥digo para reproduzir o erro
3. Inclua logs de erro completos
4. Especifique vers√£o do Node.js e Baileys

---
